jQuery(document).ready(function(i){IWAjax.openPanels={},IWAjax.ajaxSemaphore=!1;var e=function(e){e.find(".inside").each(function(){var e=i(this).prop("id");IWAjax.openPanels[e]=i(this).parent(".postbox").hasClass("closed")?0:1})},a=function(e,a){if("undefined"!=typeof a.responseText&&a.responseText.match(/intelliwidget/))for(var t in IWAjax.openPanels)IWAjax.openPanels.hasOwnProperty(t)&&1==IWAjax.openPanels[t]&&(i("#"+t).parent(".postbox").removeClass("closed"),i("#"+t).show())},t=function(){i(".iw-tabbed-sections").each(function(){var e=i(this);e.data("viewWidth",0),e.data("visWidth",0),e.data("leftTabs",[]),e.data("rightTabs",[]),e.data("visTabs",[]),e.find(".iw-tab").each(function(){e.data("visTabs").push(i(this).prop("id")),e.data("visWidth",e.data("visWidth")+i(this).outerWidth()),i(this).show()})}),s()},s=function(){i(".iw-tabbed-sections").each(function(){var e=i(this);if(e.data("viewWidth",e.find(".iw-tabs").width()-24),e.data("viewWidth")>0)for(count=0;e.data("visTabs").length&&e.data("visWidth")>e.data("viewWidth");){var a=e.data("visTabs").shift(),t=i("#"+a).outerWidth();if(e.data("visWidth",e.data("visWidth")-t),i("#"+a).hide(),e.data("leftTabs").push(a),++count>50)break}}),o()},n=function(e){var a,t=e.parent(".iw-tabbed-sections");(a=t.data("visTabs").pop())&&(t.data("visWidth",t.data("visWidth")-i("#"+a).outerWidth()),i("#"+a).hide(),t.data("rightTabs").unshift(a)),(a=t.data("leftTabs").pop())&&(t.data("visWidth",t.data("visWidth")+i("#"+a).outerWidth()),i("#"+a).show(),t.data("visTabs").unshift(a)),o()},d=function(e){var a,t=e.parent(".iw-tabbed-sections");(a=t.data("visTabs").shift())&&(t.data("visWidth",t.data("visWidth")-i("#"+a).outerWidth()),i("#"+a).hide(),t.data("leftTabs").push(a)),(a=t.data("rightTabs").shift())&&(t.data("visWidth",t.data("visWidth")+i("#"+a).outerWidth()),i("#"+a).show(),t.data("visTabs").push(a)),o()},o=function(){i(".iw-larr, .iw-rarr").css("visibility","hidden"),i(".iw-tabbed-sections").each(function(){var e=i(this);e.data("rightTabs").length&&e.find(".iw-rarr").css("visibility","visible"),e.data("leftTabs").length&&e.find(".iw-larr").css("visibility","visible")})},l=function(e){i(e).find(".postbox .hndle, .handlediv").on("click",function(){var e=i(this).parent(".postbox"),a=e.attr("id");e.toggleClass("closed"),a&&(!e.hasClass("closed")&&i.isFunction(postboxes.pbshow)?postboxes.pbshow(a):e.hasClass("closed")&&i.isFunction(postboxes.pbhide)&&postboxes.pbhide(a))})},r=function(){i(this).prop("disabled",!0),i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure"),i("body").off("click","#iw_cdfsave",r),i("#intelliwidget_cpt_spinner").show();var e={};return i("input[name=post_ID],input[name=iwpage],.intelliwidget-input").each(function(){fieldID=i(this).attr("id"),e[fieldID]=i(this).val()}),e.action="iw_"+IWAjax.objtype+"_cdfsave",i.post(IWAjax.ajaxurl,e,function(){return i("#iw_cdfsave").prop("disabled",!1),i("#intelliwidget_cpt_spinner").hide(),i(".iw-cdf-container").addClass("success"),!1}).fail(function(){return i("#iw_cdfsave").prop("disabled",!1),i("#intelliwidget_cpt_spinner").hide(),i(".iw-cdf-container").addClass("failure"),!1}),!1},c=function(i){var e=i.split("_"),a=e.pop(),t=e.pop();return t+"_"+a},p=function(){if(!0===IWAjax.ajaxSemaphore)return!1;IWAjax.ajaxSemaphore=!0,i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var a=i(this).parents(".iw-tabbed-section").first(),t=a.parent(".iw-tabbed-sections");return thisID=a.attr("id"),savecontainer=a.find(".iw-save-container"),savebutton=a.find(".iw-save"),pre=c(thisID),postData={},i(savebutton).prop("disabled",!0),e(a),i(".intelliwidget_"+pre+"_spinner").show(),i("body").off("click",savebutton,p),postData["intelliwidget_"+pre+"_post_types"]=[],postData.iwpage=i("#iwpage").val(),postData[IWAjax.idfield]=i("#"+IWAjax.idfield).val(),a.find("select,textarea,input[type=text],input[type=checkbox]:checked,input[type=hidden]").each(function(){fieldID=i(this).prop("id"),fieldID.indexOf("_post_types")>0?postData["intelliwidget_"+pre+"_post_types"].push(i(this).val()):postData[fieldID]=i(this).val(),fieldID.indexOf("_menu_location")>0&&""!=i(this).val()&&(postData["intelliwidget_"+pre+"_replace_widget"]="nav_menu_location-"+i(this).val())}),postData.action="iw_"+IWAjax.objtype+"_save",i.post(IWAjax.ajaxurl,postData,function(e){if("fail"==e)savecontainer.addClass("failure");else{var s=i(e.tab),n=i(".iw-tabs").find("#"+s.prop("id"));n.html(s.html()),a.html(e.form),"post"==IWAjax.objtype&&l(a),t.tabs("refresh").tabs({active:n.index()}),a.find(".iw-save-container").addClass("success")}return savebutton.prop("disabled",!1),i(".intelliwidget_"+pre+"_spinner").hide(),IWAjax.ajaxSemaphore=!1,!1},"json").fail(function(){return savebutton.prop("disabled",!1),i(".intelliwidget_"+pre+"_spinner").hide(),savecontainer.addClass("failure"),IWAjax.ajaxSemaphore=!1,!1}),IWAjax.ajaxSemaphore=!1,!1},h=function(){i(this).prop("disabled",!0),i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure"),i("body").off("click","#iw_copy",h),i("#intelliwidget_spinner").show();var e={};return e.iwpage=i("#iwpage").val(),e[IWAjax.idfield]=i("#"+IWAjax.idfield).val(),e.intelliwidget_widget_page_id=i("#intelliwidget_widget_page_id").val(),e.action="iw_"+IWAjax.objtype+"_copy",i.post(IWAjax.ajaxurl,e,function(){return i("#iw_copy").prop("disabled",!1),i("#intelliwidget_spinner").hide(),i(".iw-copy-container").addClass("success"),IWAjax.ajaxSemaphore=!1,!1}).fail(function(){return i("#iw_copy").prop("disabled",!1),i("#intelliwidget_spinner").hide(),i(".iw-copy-container").addClass("failure"),IWAjax.ajaxSemaphore=!1,!1}),IWAjax.ajaxSemaphore=!1,!1},f=function(e){if(!0===IWAjax.ajaxSemaphore)return!1;if(IWAjax.ajaxSemaphore=!0,e.preventDefault(),e.stopPropagation(),i(this).hasClass("disabled"))return!1;i(this).addClass("disabled",!0),i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var a=i(this).parent(".inside").find(".iw-tabbed-sections"),s=(a.prop("id"),i(this)),n=i(this).attr("href"),d=b(n);return i("#intelliwidget_spinner").show(),d.action="iw_"+IWAjax.objtype+"_add",i.post(IWAjax.ajaxurl,d,function(e){return s.removeClass("disabled"),i("#intelliwidget_spinner").hide(),"fail"==e?i(".iw-copy-container").addClass("failure"):(form=i(e.form).hide(),tab=i(e.tab).hide(),a.append(form),"post"==IWAjax.objtype&&l(form),a.find(".iw-tabs").append(tab),tab.show(),a.tabs("refresh").tabs({active:tab.index()}),t(),i(".iw-copy-container").addClass("success")),IWAjax.ajaxSemaphore=!1,!1},"json").fail(function(){return s.removeClass("disabled"),i("#intelliwidget_spinner").hide(),i(".iw-copy-container").addClass("failure"),IWAjax.ajaxSemaphore=!1,!1}),IWAjax.ajaxSemaphore=!1,!1},v=function(e){if(!0===IWAjax.ajaxSemaphore)return!1;if(IWAjax.ajaxSemaphore=!0,e.preventDefault(),e.stopPropagation(),i(this).hasClass("disabled"))return!1;i(this).addClass("disabled"),i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var a=i(this),s=a.parents(".iw-tabbed-section").first(),n=s.parent(".iw-tabbed-sections"),d=s.prop("id"),o=s.find(".iw-save-container"),l=c(d),r=i(this).attr("href"),p=b(r);return i(".intelliwidget_"+l+"_spinner").show(),p.action="iw_"+IWAjax.objtype+"_delete",i.post(IWAjax.ajaxurl,p,function(e){if(a.removeClass("disabled"),i(".intelliwidget_"+l+"_spinner").hide(),"success"==e){var d=s.index();s.remove(),i("#iw_tab_"+l).remove(),n.tabs("refresh"),t(),n.tabs({active:d})}else o.addClass("failure");return IWAjax.ajaxSemaphore=!1,!1}).fail(function(){return a.removeClass("disabled"),i(".intelliwidget_"+l+"_spinner").hide(),o.addClass("failure"),IWAjax.ajaxSemaphore=!1,!1}),IWAjax.ajaxSemaphore=!1,!1},w=function(){i(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var e=i(this).parents(".iw-tabbed-section").first(),a=e.prop("id"),t=c(a),s=e.find("#intelliwidget_"+t+"_menus"),n=e.find(".iw-save-container"),d=e.find(".iw-save"),o={};return s.has("select").length?!1:(i(d).prop("disabled",!0),i(".intelliwidget_"+t+"_spinner").show(),o.iwpage=i("#iwpage").val(),o[IWAjax.idfield]=i("#"+IWAjax.idfield).val(),o.action="iw_"+IWAjax.objtype+"_menus",e.find('input[type="hidden"]').each(function(){fieldID=i(this).attr("id"),o[fieldID]=i(this).val()}),i.post(IWAjax.ajaxurl,o,function(a){return"fail"==a?n.addClass("failure"):(s.html(a),e.find(".iw-save-container").addClass("success")),d.prop("disabled",!1),i(".intelliwidget_"+t+"_spinner").hide(),!1}).fail(function(){return d.prop("disabled",!1),i(".intelliwidget_"+t+"_spinner").hide(),n.addClass("failure"),!1}),!1)},u=function(){var e=i(this).parents(".widget").first(),a=e.find(".widget-id").val(),t=i("#_wpnonce_widgets").val(),s="widget-"+a,n=e.find("#"+s+"-menus"),d={};return n.has("select").length?!1:(d["widget-id"]=a,d._wpnonce_widgets=t,d.action="iw_widget_menus",i.post(IWAjax.ajaxurl,d,function(i){return"fail"==i||n.html(i),!1}).fail(function(){return!1}),!1)},b=function(i){var e,a,t={},s=i.substring(i.indexOf("?")+1).split("&");for(a=0;a<s.length;a++)e=s[a].split("="),t[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return t},_=function(e,a){var t,s="#"+e+"_div",n=!a&&!i("#"+e).val(),d=i("#"+e+"_aa").val(),o=("00"+i("#"+e+"_mm").val()).slice(-2),l=("00"+i("#"+e+"_jj").val()).slice(-2),r=("00"+i("#"+e+"_hh").val()).slice(-2),c=("00"+i("#"+e+"_mn").val()).slice(-2),p=i("#"+e+"_og").val();if(!i(s).length)return!0;if(t=new Date(d,o-1,l,r,c),t.getFullYear()!=d||1+t.getMonth()!=o||t.getDate()!=l||t.getMinutes()!=c){if(1==a&&!p)return i(s).addClass("form-invalid"),i(".iw-cdfsave").prop("disabled",!0),!1;n=!0}if(i(s).removeClass("form-invalid"),i(".iw-cdfsave").prop("disabled",!1),n)p||i("#"+e+"_timestamp").html(""),i("#"+e).val("");else{if("intelliwidget_expire_date"==e&&(i("#intelliwidget_ongoing").val(i("#"+e+"_og").is(":checked")?1:0),i("#"+e+"_og").is(":checked")))return i("#"+e+"_timestamp").html(i("#intelliwidget_ongoing_label").text()),i("#"+e).val(""),!0;i("#"+e+"_timestamp").html("<b>"+i('option[value="'+i("#"+e+"_mm").val()+'"]',"#"+e+"_mm").text()+" "+l+", "+d+" @ "+r+":"+c+"</b> "),i("#"+e).val(d+"-"+i("#"+e+"_mm").val()+"-"+l+" "+r+":"+c)}return!0};i(document).ajaxComplete(a),i(".iw-tabbed-sections").tabs({active:i("iw-tab").length-1}),"post"!=IWAjax.objtype&&i("body").on("click",".iw-collapsible > .handlediv, .iw-collapsible > h4, .iw-collapsible > h3",function(a){a.stopPropagation();var t=i(this).parent(".postbox"),s=i(this).parents("div.widget, div.iw-tabbed-section").first();t.toggleClass("closed"),e(s)}),i("body").on("click",".iw-tabbed-sections .panel-selection h3, .iw-tabbed-sections .panel-selection .handlediv",w),i("body").on("click",".widget-inside .panel-selection h4, .widget-inside .panel-selection .handlediv",u),i("body").on("click",".iw-save",p),i("body").on("click",".iw-cdfsave",r),i("body").on("click",".iw-copy",h),i("body").on("click",".iw-add",f),i("body").on("click",".iw-delete",v),i("body").on("change",".iw-control",p),i("body").on("change",".iw-widget-control",function(){var a=i(this).parents("div.widget").first();e(a),wpWidgets.save(a,0,0,0)}),_("intelliwidget_event_date",!1),_("intelliwidget_expire_date",!1),i("body").on("click","a.intelliwidget-edit-timestamp",function(){var e=i(this).attr("id").split("-",1);return i("#"+e+"_div").is(":hidden")&&(i("#"+e+"_div").slideDown("fast"),i("#"+e+"_mm").focus(),i(this).hide()),!1}),i("body").on("click",".intelliwidget-clear-timestamp",function(){var e=i(this).attr("id").split("-",1);return i("#"+e+"_div").slideUp("fast"),i("#"+e+"_mm").val(i("#"+e+"_cur_mm").val()),i("#"+e+"_jj").val(i("#"+e+"_cur_jj").val()),i("#"+e+"_aa").val(i("#"+e+"_cur_aa").val()),i("#"+e+"_hh").val(i("#"+e+"_cur_hh").val()),i("#"+e+"_mn").val(i("#"+e+"_cur_mn").val()),i("#"+e+"_og").prop("checked",!1),i("#"+e+"_timestamp").html(""),i("#"+e).val(""),i("a#"+e+"-edit").show(),_(e,!1),!1}),i("body").on("click",".intelliwidget-cancel-timestamp",function(){var e=i(this).attr("id").split("-",1);return i("#"+e+"_div").slideUp("fast"),i("#"+e+"_mm").val(i("#"+e+"_hidden_mm").val()),i("#"+e+"_jj").val(i("#"+e+"_hidden_jj").val()),i("#"+e+"_aa").val(i("#"+e+"_hidden_aa").val()),i("#"+e+"_hh").val(i("#"+e+"_hidden_hh").val()),i("#"+e+"_mn").val(i("#"+e+"_hidden_mn").val()),i("#"+e+"_og").prop("checked",i("#"+e+"_hidden_og").val()?!0:!1),i("a#"+e+"-edit").show(),_(e,!1),!1}),i("body").on("click",".intelliwidget-save-timestamp",function(){var e=i(this).attr("id").split("-",1);return _(e,!0)&&(i("#"+e+"_div").slideUp("fast"),i("a#"+e+"-edit").show()),!1}),i(".iw-tabbed-sections").on("click",".iw-larr, .iw-rarr",function(e){e.preventDefault(),e.stopPropagation(),i(this).is(":visible")&&(i(this).hasClass("iw-larr")?n(i(this)):d(i(this)))}),i(window).resize(s),i(".iw-tabbed-sections").slideDown(),t()});