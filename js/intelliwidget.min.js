/*!
 * intelliwidget.js - Javascript for the Admin.
 *
 * @package IntelliWidget
 * @subpackage js
 * @author Jason C Fleming
 * @copyright 2014 Lilaea Media LLC
 * @access public
 *
 */
;jQuery(document).ready(function(d){IWAjax.openPanels={};IWAjax.ajaxSemaphore=false;var o=function(t){t.find(".inside").each(function(){var u=d(this).prop("id");IWAjax.openPanels[u]=d(this).parent(".postbox").hasClass("closed")?0:1})},c=function(u,t,w){if("undefined"==typeof t.responseText||!t.responseText.match(/intelliwidget/)){return}for(var v in IWAjax.openPanels){if(IWAjax.openPanels.hasOwnProperty(v)&&IWAjax.openPanels[v]==1){d("#"+v).parent(".postbox").removeClass("closed");d("#"+v).show()}}},r=function(){d(".iw-tabbed-sections").each(function(){var t=d(this);t.data("viewWidth",0);t.data("visWidth",0);t.data("leftTabs",[]);t.data("rightTabs",[]);t.data("visTabs",[]);t.find(".iw-tab").each(function(){t.data("visTabs").push(d(this).prop("id"));t.data("visWidth",t.data("visWidth")+d(this).outerWidth());d(this).show()})});q()},q=function(){d(".iw-tabbed-sections").each(function(){var t=d(this);t.data("viewWidth",t.find(".iw-tabs").width()-24);if(t.data("viewWidth")>0){count=0;while(t.data("visTabs").length&&t.data("visWidth")>t.data("viewWidth")){var v=t.data("visTabs").shift(),u=d("#"+v).outerWidth();t.data("visWidth",t.data("visWidth")-u);d("#"+v).hide();t.data("leftTabs").push(v);if(++count>50){break}}}});e()},n=function(u){var t=u.parent(".iw-tabbed-sections"),v;if(v=t.data("visTabs").pop()){t.data("visWidth",t.data("visWidth")-d("#"+v).outerWidth());d("#"+v).hide();t.data("rightTabs").unshift(v)}if(v=t.data("leftTabs").pop()){t.data("visWidth",t.data("visWidth")+d("#"+v).outerWidth());d("#"+v).show();t.data("visTabs").unshift(v)}e()},f=function(v){var t=v.parent(".iw-tabbed-sections"),u;if(u=t.data("visTabs").shift()){t.data("visWidth",t.data("visWidth")-d("#"+u).outerWidth());d("#"+u).hide();t.data("leftTabs").push(u)}if(u=t.data("rightTabs").shift()){t.data("visWidth",t.data("visWidth")+d("#"+u).outerWidth());d("#"+u).show();t.data("visTabs").push(u)}e()},e=function(){d(".iw-larr, .iw-rarr").css("visibility","hidden");d(".iw-tabbed-sections").each(function(){var t=d(this);if(t.data("rightTabs").length){t.find(".iw-rarr").css("visibility","visible")}if(t.data("leftTabs").length){t.find(".iw-larr").css("visibility","visible")}})},l=function(t){d(t).find(".postbox .hndle, .handlediv").on("click",function(v){var u=d(this).parent(".postbox"),w=u.attr("id");u.toggleClass("closed");if(w){if(!u.hasClass("closed")&&d.isFunction(postboxes.pbshow)){postboxes.pbshow(w)}else{if(u.hasClass("closed")&&d.isFunction(postboxes.pbhide)){postboxes.pbhide(w)}}}})},i=function(){d(this).prop("disabled",true);d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");d("body").off("click","#iw_cdfsave",i);d("#intelliwidget_cpt_spinner").show();var t={};d("input[name=post_ID],input[name=iwpage],.intelliwidget-input").each(function(u,v){fieldID=d(this).attr("id");t[fieldID]=d(this).val()});t.action="iw_"+IWAjax.objtype+"_cdfsave";d.post(IWAjax.ajaxurl,t,function(u){d("#iw_cdfsave").prop("disabled",false);d("#intelliwidget_cpt_spinner").hide();d(".iw-cdf-container").addClass("success");return false}).fail(function(){d("#iw_cdfsave").prop("disabled",false);d("#intelliwidget_cpt_spinner").hide();d(".iw-cdf-container").addClass("failure");return false});return false},m=function(w){var v=w.split("_"),u=v.pop(),t=v.pop();return t+"_"+u},j=function(){if(true===IWAjax.ajaxSemaphore){return false}IWAjax.ajaxSemaphore=true;d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var u=d(this).parents(".iw-tabbed-section").first(),t=u.parent(".iw-tabbed-sections");thisID=u.attr("id"),savecontainer=u.find(".iw-save-container"),savebutton=u.find(".iw-save"),pre=m(thisID),postData={};d(savebutton).prop("disabled",true);o(u);d(".intelliwidget_"+pre+"_spinner").show();d("body").off("click",savebutton,j);postData["intelliwidget_"+pre+"_post_types"]=[];postData.iwpage=d("#iwpage").val();postData[IWAjax.idfield]=d("#"+IWAjax.idfield).val();u.find("select,textarea,input[type=text],input[type=checkbox]:checked,input[type=hidden]").each(function(){fieldID=d(this).prop("id");if(fieldID.indexOf("_post_types")>0){postData["intelliwidget_"+pre+"_post_types"].push(d(this).val())}else{postData[fieldID]=d(this).val()}});postData.action="iw_"+IWAjax.objtype+"_save";d.post(IWAjax.ajaxurl,postData,function(v){if("fail"==v){savecontainer.addClass("failure")}else{var x=d(v.tab),w=d(".iw-tabs").find("#"+x.prop("id"));w.html(x.html());u.html(v.form);if("post"==IWAjax.objtype){l(u)}t.tabs("refresh").tabs({active:w.index()});u.find(".iw-save-container").addClass("success")}savebutton.prop("disabled",false);d(".intelliwidget_"+pre+"_spinner").hide();IWAjax.ajaxSemaphore=false;return false},"json").fail(function(){savebutton.prop("disabled",false);d(".intelliwidget_"+pre+"_spinner").hide();savecontainer.addClass("failure");IWAjax.ajaxSemaphore=false;return false});IWAjax.ajaxSemaphore=false;return false},s=function(){d(this).prop("disabled",true);d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");d("body").off("click","#iw_copy",s);d("#intelliwidget_spinner").show();var t={};t.iwpage=d("#iwpage").val();t[IWAjax.idfield]=d("#"+IWAjax.idfield).val();t.intelliwidget_widget_page_id=d("#intelliwidget_widget_page_id").val();t.action="iw_"+IWAjax.objtype+"_copy";d.post(IWAjax.ajaxurl,t,function(u){d("#iw_copy").prop("disabled",false);d("#intelliwidget_spinner").hide();d(".iw-copy-container").addClass("success");IWAjax.ajaxSemaphore=false;return false}).fail(function(){d("#iw_copy").prop("disabled",false);d("#intelliwidget_spinner").hide();d(".iw-copy-container").addClass("failure");IWAjax.ajaxSemaphore=false;return false});IWAjax.ajaxSemaphore=false;return false},k=function(x){if(true===IWAjax.ajaxSemaphore){return false}IWAjax.ajaxSemaphore=true;x.preventDefault();x.stopPropagation();if(d(this).hasClass("disabled")){return false}d(this).addClass("disabled",true);d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var u=d(this).parent(".inside").find(".iw-tabbed-sections"),y=u.prop("id"),w=d(this),v=d(this).attr("href"),t=g(v);d("#intelliwidget_spinner").show();t.action="iw_"+IWAjax.objtype+"_add";d.post(IWAjax.ajaxurl,t,function(z){w.removeClass("disabled");d("#intelliwidget_spinner").hide();if("fail"==z){d(".iw-copy-container").addClass("failure")}else{form=d(z.form).hide();tab=d(z.tab).hide();u.append(form);if("post"==IWAjax.objtype){l(form)}u.find(".iw-tabs").append(tab);tab.show();u.tabs("refresh").tabs({active:tab.index()});r();d(".iw-copy-container").addClass("success")}IWAjax.ajaxSemaphore=false;return false},"json").fail(function(){w.removeClass("disabled");d("#intelliwidget_spinner").hide();d(".iw-copy-container").addClass("failure");IWAjax.ajaxSemaphore=false;return false});IWAjax.ajaxSemaphore=false;return false},p=function(A){if(true===IWAjax.ajaxSemaphore){return false}IWAjax.ajaxSemaphore=true;A.preventDefault();A.stopPropagation();if(d(this).hasClass("disabled")){return false}d(this).addClass("disabled");d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var x=d(this),t=x.parents(".iw-tabbed-section").first(),v=t.parent(".iw-tabbed-sections"),B=t.prop("id"),z=t.find(".iw-save-container"),y=m(B),u=d(this).attr("href"),w=g(u);d(".intelliwidget_"+y+"_spinner").show();w.action="iw_"+IWAjax.objtype+"_delete";d.post(IWAjax.ajaxurl,w,function(C){x.removeClass("disabled");d(".intelliwidget_"+y+"_spinner").hide();if("success"==C){var D=t.index();t.remove();d("#iw_tab_"+y).remove();v.tabs("refresh");r();v.tabs({active:D})}else{z.addClass("failure")}IWAjax.ajaxSemaphore=false;return false}).fail(function(){x.removeClass("disabled");d(".intelliwidget_"+y+"_spinner").hide();z.addClass("failure");IWAjax.ajaxSemaphore=false;return false});IWAjax.ajaxSemaphore=false;return false},b=function(){d(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var x=d(this).parents(".iw-tabbed-section").first(),z=x.prop("id"),w=m(z),u=x.find("#intelliwidget_"+w+"_menus"),y=x.find(".iw-save-container"),v=x.find(".iw-save"),t={};if(u.has("select").length){return false}d(v).prop("disabled",true);d(".intelliwidget_"+w+"_spinner").show();t.iwpage=d("#iwpage").val();t[IWAjax.idfield]=d("#"+IWAjax.idfield).val();t.action="iw_"+IWAjax.objtype+"_menus";x.find('input[type="hidden"]').each(function(A,B){fieldID=d(this).attr("id");t[fieldID]=d(this).val()});d.post(IWAjax.ajaxurl,t,function(A){if("fail"==A){y.addClass("failure")}else{u.html(A);x.find(".iw-save-container").addClass("success")}v.prop("disabled",false);d(".intelliwidget_"+w+"_spinner").hide();return false}).fail(function(){v.prop("disabled",false);d(".intelliwidget_"+w+"_spinner").hide();y.addClass("failure");return false});return false},a=function(){var x=d(this).parents(".widget").first(),y=x.find(".widget-id").val(),u=d("#_wpnonce_widgets").val(),w="widget-"+y,v=x.find("#"+w+"-menus"),t={};if(v.has("select").length){return false}t["widget-id"]=y;t._wpnonce_widgets=u;t.action="iw_widget_menus";d.post(IWAjax.ajaxurl,t,function(z){if("fail"==z){}else{v.html(z)}return false}).fail(function(){return false});return false},g=function(t){var x,u,v={},w=t.substring(t.indexOf("?")+1).split("&");for(u=0;u<w.length;u++){x=w[u].split("=");v[decodeURIComponent(x[0])]=decodeURIComponent(x[1])}return v},h=function(C,B){var z,u="#"+C+"_div",A=(!B&&!d("#"+C).val()),t=d("#"+C+"_aa").val(),x=("00"+d("#"+C+"_mm").val()).slice(-2),y=("00"+d("#"+C+"_jj").val()).slice(-2),w=("00"+d("#"+C+"_hh").val()).slice(-2),v=("00"+d("#"+C+"_mn").val()).slice(-2),D=d("#"+C+"_og").val();if(!d(u).length){return true}z=new Date(t,x-1,y,w,v);if(z.getFullYear()!=t||(1+z.getMonth())!=x||z.getDate()!=y||z.getMinutes()!=v){if(true==B&&!D){d(u).addClass("form-invalid");d(".iw-cdfsave").prop("disabled",true);return false}A=true}d(u).removeClass("form-invalid");d(".iw-cdfsave").prop("disabled",false);if(A){if(!D){d("#"+C+"_timestamp").html("")}d("#"+C).val("")}else{if("intelliwidget_expire_date"==C){d("#intelliwidget_ongoing").val(d("#"+C+"_og").is(":checked")?1:0);if(d("#"+C+"_og").is(":checked")){d("#"+C+"_timestamp").html(d("#intelliwidget_ongoing_label").text());d("#"+C).val("");return true}}d("#"+C+"_timestamp").html("<b>"+d('option[value="'+d("#"+C+"_mm").val()+'"]',"#"+C+"_mm").text()+" "+y+", "+t+" @ "+w+":"+v+"</b> ");d("#"+C).val(t+"-"+d("#"+C+"_mm").val()+"-"+y+" "+w+":"+v)}return true};d(document).ajaxComplete(c);d(".iw-tabbed-sections").tabs({active:(d("iw-tab").length-1)});if("post"!=IWAjax.objtype){d("body").on("click",".iw-collapsible > .handlediv, .iw-collapsible > h4, .iw-collapsible > h3",function(u){u.stopPropagation();var t=d(this).parent(".postbox"),v=d(this).parents("div.widget, div.iw-tabbed-section").first();t.toggleClass("closed");o(v)})}d("body").on("click",".iw-tabbed-sections .panel-selection h3, .iw-tabbed-sections .panel-selection .handlediv",b);d("body").on("click",".widget-inside .panel-selection h4, .widget-inside .panel-selection .handlediv",a);d("body").on("click",".iw-save",j);d("body").on("click",".iw-cdfsave",i);d("body").on("click",".iw-copy",s);d("body").on("click",".iw-add",k);d("body").on("click",".iw-delete",p);d("body").on("change",".iw-control",j);d("body").on("change",".iw-widget-control",function(t){var u=d(this).parents("div.widget").first();o(u);wpWidgets.save(u,0,0,0)});h("intelliwidget_event_date",false);h("intelliwidget_expire_date",false);d("body").on("click","a.intelliwidget-edit-timestamp",function(){var t=d(this).attr("id").split("-",1);if(d("#"+t+"_div").is(":hidden")){d("#"+t+"_div").slideDown("fast");d("#"+t+"_mm").focus();d(this).hide()}return false});d("body").on("click",".intelliwidget-clear-timestamp",function(){var t=d(this).attr("id").split("-",1);d("#"+t+"_div").slideUp("fast");d("#"+t+"_mm").val(d("#"+t+"_cur_mm").val());d("#"+t+"_jj").val(d("#"+t+"_cur_jj").val());d("#"+t+"_aa").val(d("#"+t+"_cur_aa").val());d("#"+t+"_hh").val(d("#"+t+"_cur_hh").val());d("#"+t+"_mn").val(d("#"+t+"_cur_mn").val());d("#"+t+"_og").prop("checked",false);d("#"+t+"_timestamp").html("");d("#"+t).val("");d("a#"+t+"-edit").show();h(t,false);return false});d("body").on("click",".intelliwidget-cancel-timestamp",function(){var t=d(this).attr("id").split("-",1);d("#"+t+"_div").slideUp("fast");d("#"+t+"_mm").val(d("#"+t+"_hidden_mm").val());d("#"+t+"_jj").val(d("#"+t+"_hidden_jj").val());d("#"+t+"_aa").val(d("#"+t+"_hidden_aa").val());d("#"+t+"_hh").val(d("#"+t+"_hidden_hh").val());d("#"+t+"_mn").val(d("#"+t+"_hidden_mn").val());d("#"+t+"_og").prop("checked",d("#"+t+"_hidden_og").val()?true:false);d("a#"+t+"-edit").show();h(t,false);return false});d("body").on("click",".intelliwidget-save-timestamp",function(){var t=d(this).attr("id").split("-",1);if(h(t,true)){d("#"+t+"_div").slideUp("fast");d("a#"+t+"-edit").show()}return false});d(".iw-tabbed-sections").on("click",".iw-larr, .iw-rarr",function(t){t.preventDefault();t.stopPropagation();if(d(this).is(":visible")){if(d(this).hasClass("iw-larr")){n(d(this))}else{f(d(this))}}});d(window).resize(q);d(".iw-tabbed-sections").slideDown();r()});